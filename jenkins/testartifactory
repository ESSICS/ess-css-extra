pipeline {
  environment {
  serverID='artifactory-ess'
  artifactFolder='jespersfolder'
  buildSpace='css-ce'
  }
  agent {
    label 'css'
  }
  options{
  disableConcurrentBuilds() //Disallow concurrent executions of the Pipeline
  timeout(time:4, unit: 'HOURS') //Set a timeout period for the Pipeline run, after which Jenkins should abort the Pipeline
  timestamps()
  skipDefaultCheckout()
  }
  stages{
    stage('test artifact'){
      steps{
        dir("../${env.buildSpace}"){
          script { //artifactory plugin doesn't fully support declarative pipeline there for the scrip-block is needed
               def server = Artifactory.server "${env.serverID}"
               def uploadSpec = """{
                 "files": [
                   {
                     "pattern": "(org.csstudio.ess.product/repository/target/products/*.tar.gz|org.csstudio.ess.product/repository/target/products/*.zip)*",
                     "target": "CSSTest/${artifactFolder}/0.7/"
                     "regexp": "true"
                   }
                 ]
               }"""
               server.upload(uploadSpec)
            }
          }
       }
    }
  }
}
